<!--import [polymer, etools-ajax/etools-ajax-request-behavior, lodash]-->
<!--import [etools-app-config, permission-controller]-->

<dom-module id="get-attachments">
    <template>
    </template>

    <script>
        Polymer({
            is: 'get-attachments',

            behaviors: [
                etoolsAppConfig.globals,
                APBehaviors.PermissionController,
                EtoolsAjaxRequestBehavior
            ],

            properties: {
                baseId: {
                    type: Number,
                    notify: true,
                    observer: '_baseIdChanged'
                },
                endpointName: String,
                attachments: {
                    type: Array,
                    notify: true
                }

            },

            _handleResponse: function (detail) {
                this.attachments = detail || [];
                this.fire('attachments-loaded', {success: true});
            },

            _handleError: function () {
                this.fire('attachments-loaded');
            },

            _baseIdChanged: function(baseId) {
                if (!baseId) { return; }
                let url = this.getEndpoint(this.endpointName, {id: baseId}).url + '?page_size=all';

                this.sendRequest({
                    endpoint: {url}
                }).then(resp => {
                   this._handleResponse(resp);
                }).catch(err => {
                   this._handleError(err);
                });
            }
        });
    </script>
</dom-module>
