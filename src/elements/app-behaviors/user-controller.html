<!--import [lodash]-->

<script>
    'use strict';
    (function () {
        var _user, _groups;

        window.APBehaviors = window.APBehaviors || {};
        window.APBehaviors.UserController = {
            _setUserData: function(user) {
                if (_user) { throw 'User already exists!'; }

                if (!user || !_.isObject(user) || _.isArray(user)) { throw new Error('User must be an object'); }
                if (!user.user || !user.groups) { throw new Error('User must have id and groups fields!'); }

                _user = _.cloneDeep(user);
                this._setGroups(user);
            },

            _setGroups: function(user) {
                if (!user.groups.length) { throw new Error('Can not find user group!'); }
                _groups = user.groups.map((group) => {
                    return group.name;
                });
            },

            getUserData: function() {
                return _.cloneDeep(_user);
            },

            isAuditor: function() {
                if (!_groups) { throw new Error('User data is missing or incorrect'); }
                return !!~_groups.indexOf('Auditor');
            }
        };
    })()
</script>
