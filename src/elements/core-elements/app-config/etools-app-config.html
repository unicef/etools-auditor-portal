<!--
App global configuration
-->
<!--import [polymer, etools-dexiejs, lodash]-->

<script>
    'use strict';

    var etoolsCustomDexieDb = new Dexie('AP');

    etoolsCustomDexieDb.version(1).stores({
        collectionsList: '&name, expire',
        partners: 'id',
        sections: 'id',
        offices: 'id'
    });

    var etoolsAppConfig = {
        // app endpoints
        endpoints: {
            userProfile: {
                url: '/users/api/profile/'
            },
            engagementsList: {
                url: '/api/audit/engagements/'
            },
            engagementInfo: {
                template: '/api/audit/<%=type%>/<%=id%>/'
            },
            createEngagement: {
                template: '/api/audit/engagements/'
            },
            partnerOrganisations: {
                url: '/api/v2/partners/?hidden=false',
                exp: 24 * 60 * 60 * 1000, // 24h
                cachingKey: 'partners'
            },
            partnerInfo: {
                template: '/api/v2/partners/<%=id%>/'
            },
            authorizedOfficers: {
                template: '/api/v2/partners/<%=id%>/staff-members/'
            },
            filterAuditors: {
                url: '/api/audit/audit-firms/'
            },
            filterPartners : {
                url: '/api/audit/engagements/partners/'
            },
            agreementData: {
                template: '/api/audit/purchase-orders/sync/<%=id%>/'
            },
            purchaseOrder: {
                template: '/api/audit/purchase-orders/<%=id%>/'
            },
            staffMembers: {
                template: '/api/audit/audit-firms/<%=id%>/staff-members/'
            },
            userExistence: {
                template: '/api/audit/audit-firms/users/?email=<%=email%>'
            },
            changeCountry: {
                url: '/users/api/changecountry/'
            },
            users: {
                url: '/api/users/'
            },
            staffMembersUsers: {
                url: '/api/audit/audit-firms/users/?purchase_order_auditorstaffmember__auditor_firm__unicef_users_allowed=true'
            },
            sectionsCovered: {
                url: '/api/reports/sectors/',
                exp: 24 * 60 * 60 * 1000, // 24h
                cachingKey: 'sections'
            },
            offices: {
                url: '/api/offices/',
                exp: 23 * 60 * 60 * 1000, // 23h
                cachingKey: 'offices'
            },
            reportAttachments: {
                template: '/api/audit/engagements/<%=id%>/report-attachments/'
            },
            attachments: {
                template: '/api/audit/engagements/<%=id%>/engagement-attachments/'
            }
        },

        globals: {
            // globals
            baseSite: window.location.origin,
            basePath: (window.location.port === '8080') ? '/' : '/ap/',
            serverBackend: (window.location.port !== '8080'),
            //epsPath: (window.location.port !== '8080') ? 'endpoints' : 'localEndpoints',
            epsPath:  'endpoints',

            // dexie js
            appDexieDb: etoolsCustomDexieDb,

            productionDomain: 'etools.unicef.org',
            stagingDomain: 'etools-staging.unicef.org',

            getEndpoint: function (endpointName, data) {
                var endpoint = etoolsAppConfig[etoolsAppConfig.globals.epsPath][endpointName];
                if (endpoint && endpoint.hasOwnProperty('template') && endpoint.template !== '') {
                    endpoint.url = this.baseSite + _.template(endpoint.template)(data);
                }
                return _.clone(endpoint);
            },

            resetOldUserData: function() {
                console.log('resetOldUserData()');

                localStorage.removeItem('userId');

                etoolsCustomDexieDb.collectionsList.clear();
                etoolsCustomDexieDb.partners.clear();
            },

            getAbsolutePath: function(path) {
                path = path || '';
                return this.basePath + path;
            },

            isProductionServer: function() {
                var location = window.location.href;
                return location.indexOf(this.productionDomain) > -1;
            },

            isStagingServer: function() {
                var location = window.location.href;
                return location.indexOf(this.stagingDomain) > -1;
            }
        }
    };
</script>
