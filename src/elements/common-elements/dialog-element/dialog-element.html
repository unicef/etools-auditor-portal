<!--import [polymer, iron-icon, paper-dialog]-->

<dom-module id="dialog-element">
    <template>
        <style>
            paper-dialog {
                background-color: #ffffff;
                border-radius: 4px;
            }

            @media screen and (max-width: 767px) {
                paper-dialog {
                    width: calc(100vw - 30px);
                }
            }

            @media screen and (max-width: 480px) {
                paper-dialog {
                    width: calc(100vw - 30px);
                }
            }

            #buttons {
                padding: 18px 8px 17px 24px;

            }

            .btn-cancel {
                color: var(--module-error);
                font-weight: 500;
                &:not([dialog-dismiss]) { color: var(--gray-mid); }
            }

            .btn-confirm {
                color: var(--module-primary);
                font-weight: bold;
            }

            .dialog-title {
                padding: 16px 24px 10px !important;
                min-height: 26px;
            }

            .close-btn {
                position: absolute;
                right: -5px;
                top: 4px;
                margin-top: 14px !important;
                color: var(--gray-mid-dark);
                cursor: pointer;
                transition: 0.15s;
                z-index: 5;
            }
            .close-btn:hover { color: #000;}

            .loading {
                margin-top: 3px;
                vertical-align: top;
                margin-left: 15px;
            }

            .loading:not([active]) {
                display: none !important;
            }

        </style>

        <paper-dialog opened="{{opened}}"
                      modal="{{requestInProcess}}"
                      with-backdrop
                      ok-btn-text="sync from vision">
            <iron-icon icon="icons:close" class="close-btn" dialog-dismiss$="{{!requestInProcess}}"></iron-icon>
            <h2 class="dialog-title">[[dialogTitle]]<etools-loading active="{{requestInProcess}}" no-overlay loading-text="" class="loading"></etools-loading></h2>
            <slot></slot>
            <div class="buttons" id="buttons">
                <paper-button dialog-dismiss$="{{_setDialogDismiss(requestInProcess, confirmDialogOpened)}}" class="btn-cancel" on-tap="cancelDialog">[[cancelBtnText]]</paper-button>
                <paper-button autofocus class="btn-confirm" on-tap="confirmDialog">[[confirmBtnText]]</paper-button>
            </div>
        </paper-dialog>
    </template>

    <script>
        'use strict';

        Polymer({
            is: 'dialog-element',
            properties: {
                dialogTitle: {
                    type: String,
                    value: 'Custom title'
                },
                cancelBtnText: {
                    type: String,
                    value: 'Cancel'
                },
                confirmBtnText: {
                    type: String,
                    value: 'Ok'
                },
                opened: {
                    type: Boolean,
                    notify: true,
                    observer: '_openedChanged'
                },
                requestInProcess: {
                    type: Boolean,
                    value: false,
                    notify: true
                },
                confirmDialogOpened: {
                    type: Boolean,
                    value: false
                },
                dialogName: String
            },
            _setDialogDismiss: function(requestInProcess, confirmDialogOpened) {
                return !requestInProcess && !confirmDialogOpened;
            },
            confirmDialog: function() {
                this.fire('dialog-confirmed', {dialogName: this.dialogName});
            },
            cancelDialog: function() {
                this.fire('dialog-cancelled', {dialogName: this.dialogName});
            },
            _openedChanged: function(opened) {
                if (!opened && this.requestInProcess) {
                    this.opened = true;
                }
            }
        });
    </script>
</dom-module>