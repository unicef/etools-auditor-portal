<!--import [polymer, app-route, app-layout, paper-tabs, iron-pages, app-route/app-location, lodash, etools-content-panel]-->
<!--import [shared-styles, module-styles, main-page-styles, tab-inputs-styles, app-main-header, pages-header-element,
            file-attachments-tab, update-engagement, status-tab-element, engagement-staff-members-tab, engagement-info-details,
            engagement-info-data, engagement-behavior, partner-details-tab, etools-dialog, follow-up-main, specific-procedure, sa-report-page-main]-->

<dom-module id="special-audits-page-main">
    <template>
        <style include="shared-styles module-styles main-page-styles tab-inputs-styles">
            .repeatable-item-container {
                margin-bottom: 0 !important;
            }
        </style>

        <app-route
                route="{{route}}"
                pattern="/:id/:tab"
                data="{{routeData}}">
        </app-route>

        <engagement-info-data
                engagement-id="{{engagementId}}"
                engagement-type="special-audits"
                engagement-info="{{engagement}}">
        </engagement-info-data>

        <update-engagement
                updated-engagement-data="{{updatedEngagement}}"
                quiet-adding="{{quietAdding}}"
                force-options-update="{{forceOptionsUpdate}}"
                engagement="{{engagement}}"
                error-object="{{errorObject}}"
                base-permission-path="{{permissionBase}}">
        </update-engagement>


        <template is="dom-if" if="{{engagement.id}}" restamp>
            <pages-header-element
                    show-export-button
                    hide-print-button
                    export-links="[[_setExportLinks(engagement)]]"
                    engagement="[[engagement]]"
                    page-title="[[engagement.partner.name]] - Audit">
            </pages-header-element>

            <div class="tab-selector">
                <paper-tabs
                        attr-for-selected="name"
                        noink bottom-item
                        role="tablist"
                        tabindex="0"
                        selected="{{tab}}"
                        id="pageTabs">
                    <paper-tab name="overview">
                        <span class="tab-content">Engagement Overview</span>
                    </paper-tab>

                    <template is="dom-if" if="{{_showReportTabs(permissionBase, engagement)}}" restamp>
                        <paper-tab name="report">
                            <span class="tab-content">Report</span>
                        </paper-tab>
                    </template>

                    <template is="dom-if" if="{{_showFollowUpTabs(permissionBase)}}" restamp>
                        <paper-tab name="follow-up">
                            <span class="tab-content">Follow-Up</span>
                        </paper-tab>
                    </template>

                    <paper-tab name="attachments"><span class="tab-content">Attachments</span></paper-tab>
                </paper-tabs>
            </div>

            <div class="view-container">
                <div id="pageContent">
                    <iron-pages
                            id="info-tabs"
                            selected="{{tab}}"
                            attr-for-selected="name">
                        <div name="overview">
                            <template is="dom-if" if="{{_showCancellationReason(engagement)}}">
                                <etools-content-panel class="cancellation-tab" panel-title="">
                                    <div slot="panel-btns" class="bookmark">
                                        <iron-icon icon="bookmark"></iron-icon>
                                    </div>

                                    <div class="cancellation-title">Cancellation Note</div>
                                    <div class="cancellation-text">[[engagement.cancel_comment]]</div>
                                </etools-content-panel>
                            </template>

                            <engagement-info-details
                                    id="engagementDetails"
                                    data="{{engagement}}"
                                    original-data="[[originalData]]"
                                    error-object="{{errorObject}}"
                                    base-permission-path="{{permissionBase}}">
                            </engagement-info-details>

                            <partner-details-tab
                                    id="partnerDetails"
                                    original-data="[[originalData]]"
                                    engagement="{{engagement}}"
                                    error-object="{{errorObject}}"
                                    base-permission-path="{{permissionBase}}">
                            </partner-details-tab>

                            <specific-procedure
                                    id="specificProcedures"
                                    class="mb-15"
                                    without-finding-column
                                    error-object="{{errorObject}}"
                                    data-items="{{engagement.specific_procedures}}"
                                    base-permission-path="{{permissionBase}}"
                                    readonly-tab>
                            </specific-procedure>

                            <engagement-staff-members-tab
                                    id="staffMembers"
                                    engagement="{{engagement}}"
                                    error-object="{{errorObject}}"
                                    base-permission-path="{{permissionBase}}">
                            </engagement-staff-members-tab>
                        </div>

                        <template is="dom-if" if="{{_showReportTabs(permissionBase, engagement)}}" restamp>
                            <div name="report">
                                <sa-report-page-main
                                        id="report"
                                        original-data="[[originalData]]"
                                        error-object="{{errorObject}}"
                                        engagement="{{engagement}}"
                                        permission-base="{{permissionBase}}">
                                </sa-report-page-main>
                            </div>
                        </template>

                        <template is="dom-if" if="{{_showFollowUpTabs(permissionBase)}}" restamp>
                            <div name="follow-up">
                                <follow-up-main
                                        id="follow-up"
                                        original-data="[[originalData]]"
                                        error-object="{{errorObject}}"
                                        engagement="{{engagement}}"
                                        permission-base="{{permissionBase}}">
                                </follow-up-main>
                            </div>
                        </template>

                        <div name="attachments">
                            <file-attachments-tab
                                    id="engagement_attachments"
                                    data-base-path="[[permissionBase]]"
                                    path-postfix="attachments"
                                    base-id="[[engagement.id]]"
                                    error-object="{{errorObject}}"
                                    error-property="engagement_attachments"
                                    endpoint-name="attachments">
                            </file-attachments-tab>

                            <template is="dom-if" if="{{_showReportTabs(permissionBase, engagement)}}" restamp>
                                <file-attachments-tab
                                        id="report_attachments"
                                        data-base-path="[[permissionBase]]"
                                        path-postfix="report_attachments"
                                        base-id="[[engagement.id]]"
                                        error-object="{{errorObject}}"
                                        error-property="report_attachments"
                                        endpoint-name="reportAttachments">
                                </file-attachments-tab>
                            </template>
                        </div>
                    </iron-pages>
                </div>

                <div id="sidebar">
                    <status-tab-element
                            engagement-data="[[engagement]]"
                            permission-base="[[permissionBase]]">
                    </status-tab-element>
                </div>
            </div>

            <etools-dialog no-padding keep-dialog-open size="md"
                    opened="{{dialogOpened}}"
                    dialog-title="Cancellation of Engagement"
                    ok-btn-text="Continue"
                    on-confirm-btn-clicked="_cancelEngagement">
                <div class="row-h repeatable-item-container" without-line>
                    <div class="repeatable-item-content">
                        <div class="row-h group">
                            <div class="input-container input-container-l">
                                <paper-textarea
                                        id="cancellationReasonInput"
                                        class="required"
                                        label="Cancellation Reason"
                                        placeholder="Enter reason of cancellation"
                                        required
                                        max-rows="4"
                                        error-message="This field is required."
                                        on-focus="_resetFieldError"
                                        on-tap="_resetFieldError">
                                </paper-textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </etools-dialog>
        </template>
    </template>

    <!-- inject scripts './special-audits-page-main.js'-->
</dom-module>
