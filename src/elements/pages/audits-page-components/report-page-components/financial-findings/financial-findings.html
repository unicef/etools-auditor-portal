<!--import [polymer, paper-icon-button, paper-input, paper-input/paper-textarea, iron-icons, etools-content-panel,
            etools-currency-amount-input, etools-searchable-multiselection-menu, lodash, paper-tooltip]-->

<!--import [list-header, list-element, common-methods-behavior, tab-inputs-styles, module-styles, etools-dialog,
            table-elements-behavior, permission-controller, textarea-max-rows-behavior]-->

<dom-module id="financial-findings">
    <template>
        <style include="tab-inputs-styles tab-layout-styles module-styles"></style>
        <!-- inject styles './financial-findings.scss'-->

        <etools-content-panel
                class="content-section clearfix"
                panel-title="[[getLabel('financial_finding_set', basePermissionPath)]]">
            <div slot="panel-btns">
                <div hidden$="[[!_canBeChanged(basePermissionPath)]]">
                    <paper-icon-button
                            class="panel-button"
                            on-tap="openAddDialog"
                            icon="add-box">
                    </paper-icon-button>
                    <paper-tooltip offset="0">Add</paper-tooltip>
                </div>
            </div>

            <list-header
                    id="list-header"
                    no-ordered
                    data="[[columns]]"
                    base-permission-path="[[basePermissionPath]]">
            </list-header>

            <template is="dom-repeat" items="[[dataItems]]" filter="_showItems">
                <list-element
                        class="list-element"
                        data="[[item]]"
                        base-permission-path="[[basePermissionPath]]"
                        item-index="[[index]]"
                        headings="[[columns]]"
                        details="[[details]]"
                        has-collapse
                        no-animation>
                    <div slot="custom">
                        [[getDisplayName('financial_finding_set.title', basePermissionPath, item.title)]]
                        <paper-tooltip offset="0">[[getDisplayName('financial_finding_set.title', basePermissionPath, item.title)]]</paper-tooltip>
                    </div>
                    <div slot="hover" class="edit-icon-slot" hidden$="[[!_canBeChanged(basePermissionPath)]]">
                        <paper-icon-button icon="icons:create" class="edit-icon" on-tap="openEditDialog"></paper-icon-button>
                        <paper-icon-button icon="icons:delete" class="edit-icon" on-tap="openDeleteDialog2"></paper-icon-button>
                    </div>
                </list-element>
            </template>

            <template is="dom-if" if="[[!dataItems.length]]">
                <list-element
                        class="list-element"
                        data="[[emptyObj]]"
                        headings="[[columns]]"
                        no-animation>
                </list-element>
            </template>
        </etools-content-panel>

        <etools-dialog theme="confirmation"
                       size="md"
                       keep-dialog-open
                       opened="{{confirmDialogOpened}}"
                       on-confirm-btn-clicked="removeItem"
                       ok-btn-text="Delete">
            [[deleteTitle]]
        </etools-dialog>

        <etools-dialog id="financial-findings"
                       no-padding
                       size="md"
                       opened="{{dialogOpened}}"
                       keep-dialog-open
                       dialog-title="[[dialogTitle]]"
                       ok-btn-text="Add"
                       show-spinner="{{requestInProcess}}"
                       disable-confirm-btn="{{requestInProcess}}"
                       on-confirm-btn-clicked="_addItemFromDialog">

            <div class="row-h repeatable-item-container" without-line>
                <div class="repeatable-item-content">
                    <div class="row-h group">
                        <div class="input-container input-container-l">
                            <!-- Title -->
                            <etools-searchable-multiselection-menu
                                    class$="disabled-as-readonly validate-input [[_setRequired('financial_finding_set.title', basePermissionPath)]]"
                                    value="{{title}}"
                                    label="[[getLabel('financial_finding_set.title', basePermissionPath)]]"
                                    placeholder="[[getPlaceholderText('financial_finding_set.title', basePermissionPath)]]"
                                    options="[[titleOptions]]"
                                    custom-object-options
                                    option-label="display_name"
                                    option-value="value"
                                    selected="{{editedItem.title}}"
                                    update-selected
                                    required$="[[_setRequired('financial_finding_set.title', basePermissionPath)]]"
                                    disabled$="[[requestInProcess]]"
                                    readonly$="[[requestInProcess]]"
                                    invalid="{{errors.title}}"
                                    error-message="{{errors.title}}"
                                    on-focus="_resetFieldError"
                                    on-tap="_resetFieldError"
                                    hide-search
                                    no-title-attr>
                            </etools-searchable-multiselection-menu>
                            <paper-tooltip offset="0">[[title.display_name]]</paper-tooltip>
                        </div>
                    </div>

                    <div class="row-h group">
                        <div class="input-container input-container-ms">
                            <!-- Amount (local) -->
                            <etools-currency-amount-input
                                    class$="disabled-as-readonly validate-input {{_setRequired('financial_finding_set.local_amount', basePermissionPath)}}"
                                    value="{{editedItem.local_amount}}"
                                    currency=""
                                    label="[[getLabel('financial_finding_set.local_amount', basePermissionPath)]]"
                                    placeholder="[[getPlaceholderText('financial_finding_set.local_amount', basePermissionPath)]]"
                                    required$="[[_setRequired('financial_finding_set.local_amount', basePermissionPath)]]"
                                    disabled$="[[requestInProcess]]"
                                    readonly$="[[requestInProcess]]"
                                    invalid$="[[errors.local_amount]]"
                                    error-message="{{errors.local_amount}}"
                                    on-focus="_resetFieldError"
                                    on-tap="_resetFieldError">
                            </etools-currency-amount-input>
                        </div>

                        <div class="input-container input-container-ms">
                            <!-- Amount USD -->
                            <etools-currency-amount-input
                                    class$="disabled-as-readonly validate-input {{_setRequired('financial_finding_set.amount', basePermissionPath)}}"
                                    value="{{editedItem.amount}}"
                                    currency="$"
                                    label="[[getLabel('financial_finding_set.amount', basePermissionPath)]]"
                                    placeholder="[[getPlaceholderText('financial_finding_set.amount', basePermissionPath)]]"
                                    required$="[[_setRequired('financial_finding_set.amount', basePermissionPath)]]"
                                    disabled$="[[requestInProcess]]"
                                    readonly$="[[requestInProcess]]"
                                    invalid$="[[errors.amount]]"
                                    error-message$="[[errors.amount]]"
                                    on-focus="_resetFieldError"
                                    on-tap="_resetFieldError">
                            </etools-currency-amount-input>
                        </div>
                    </div>

                    <div class="row-h group">
                        <div class="input-container input-container-l">
                            <!-- Description -->
                            <paper-textarea
                                    class$="disabled-as-readonly fixed-width validate-input [[_setRequired('financial_finding_set.description', basePermissionPath)]]"
                                    value="{{editedItem.description}}"
                                    allowed-pattern="[\d\s]"
                                    label="[[getLabel('financial_finding_set.description', basePermissionPath)]]"
                                    placeholder="[[getPlaceholderText('financial_finding_set.description', basePermissionPath)]]"
                                    required$="[[_setRequired('financial_finding_set.description', basePermissionPath)]]"
                                    disabled$="[[requestInProcess]]"
                                    readonly$="[[requestInProcess]]"
                                    max-rows="4"
                                    invalid$="[[errors.description]]"
                                    error-message$="[[errors.description]]"
                                    on-focus="_resetFieldError"
                                    on-tap="_resetFieldError">
                            </paper-textarea>
                        </div>
                    </div>

                    <div class="row-h group">
                        <div class="input-container input-container-l">
                            <!-- Recommendation -->
                            <paper-textarea
                                    class$="disabled-as-readonly fixed-width validate-input [[_setRequired('financial_finding_set.recommendation', basePermissionPath)]]"
                                    value="{{editedItem.recommendation}}"
                                    allowed-pattern="[\d\s]"
                                    label="[[getLabel('financial_finding_set.recommendation', basePermissionPath)]]"
                                    placeholder="[[getPlaceholderText('financial_finding_set.recommendation', basePermissionPath)]]"
                                    required$="[[_setRequired('financial_finding_set.recommendation', basePermissionPath)]]"
                                    disabled$="[[requestInProcess]]"
                                    readonly$="[[requestInProcess]]"
                                    max-rows="4"
                                    invalid$="[[errors.recommendation]]"
                                    error-message$="[[errors.recommendation]]"
                                    on-focus="_resetFieldError"
                                    on-tap="_resetFieldError">
                            </paper-textarea>
                        </div>
                    </div>

                    <div class="row-h group">
                        <div class="input-container input-container-l">
                            <!-- IP comments -->
                            <paper-textarea
                                    class$="disabled-as-readonly fixed-width validate-input [[_setRequired('financial_finding_set.ip_comments', basePermissionPath)]]"
                                    value="{{editedItem.ip_comments}}"
                                    allowed-pattern="[\d\s]"
                                    label="[[getLabel('financial_finding_set.ip_comments', basePermissionPath)]]"
                                    placeholder="[[getPlaceholderText('financial_finding_set.ip_comments', basePermissionPath)]]"
                                    required$="[[_setRequired('financial_finding_set.ip_comments', basePermissionPath)]]"
                                    disabled$="[[requestInProcess]]"
                                    readonly$="[[requestInProcess]]"
                                    max-rows="4"
                                    invalid$="[[errors.ip_comments]]"
                                    error-message$="[[errors.ip_comments]]"
                                    on-focus="_resetFieldError"
                                    on-tap="_resetFieldError">
                            </paper-textarea>
                        </div>
                    </div>
                </div>
            </div>

        </etools-dialog>

    </template>

    <!-- inject scripts './financial-findings.js'-->
</dom-module>
