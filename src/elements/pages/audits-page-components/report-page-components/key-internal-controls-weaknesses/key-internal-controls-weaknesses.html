<!--import [polymer, etools-content-panel, etools-searchable-multiselection-menu, paper-input, lodash]-->
<!--import [list-header, list-element, tab-inputs-styles, module-styles, etools-dialog, common-methods-behavior,
            static-data-behavior, kicw-risk]-->

<dom-module id="key-internal-controls-weaknesses">
    <template>
        <style include="tab-inputs-styles module-styles"></style>
        <!-- inject styles './key-internal-controls-weaknesses.scss'-->

        <etools-content-panel class="content-section clearfix" panel-title="[[getLabel('key_internal_weakness', basePermissionPath)]]">
            <div class="header-content">
                <div class="static-text">
                    We have reviewed the implementation of applicable key internal controls and noted the following weaknesses:
                </div>
            </div>
            <list-header
                    no-ordered
                    data="[[columns]]"
                    base-permission-path="[[basePermissionPath]]">
            </list-header>

            <template is="dom-repeat" items="[[subjectAreas.blueprints]]">
                <list-element
                        class="list-element"
                        data="[[item]]"
                        headings="[[columns]]"
                        details="[[details]]"
                        has-collapse
                        no-animation>
                    <div slot="hover" class="edit-icon-slot" hidden$="[[!_canBeChanged(basePermissionPath)]]">
                        <paper-icon-button icon="icons:add-box" class="edit-icon" on-tap="openEditDialog"></paper-icon-button>
                    </div>
                    <div class="collapse-container" slot="custom-details">
                        <kicw-risk risks-data="[[item.risks]]"
                                   blueprint-id="[[item.id]]"
                                   is-editable="[[_canBeChanged(basePermissionPath)]]"></kicw-risk>
                    </div>
                </list-element>
            </template>

            <template is="dom-if" if="[[!subjectAreas.blueprints.length]]">
                <list-element
                        class="list-element"
                        data="[[emptyObj]]"
                        headings="[[columns]]"
                        no-animation>
                </list-element>
            </template>
        </etools-content-panel>
        <etools-dialog theme="confirmation" size="md"
                keep-dialog-open
                opened="{{confirmDialogOpened}}"
                on-confirm-btn-clicked="_deleteArea"
                disable-confirm-btn="{{requestInProcess}}"
                ok-btn-text="Delete">
            [[dialogTexts.dialogTitle]]
        </etools-dialog>
        <etools-dialog no-padding keep-dialog-open size="md"
                opened="{{dialogOpened}}"
                dialog-title="[[dialogTexts.dialogTitle]]"
                ok-btn-text="[[dialogTexts.confirmBtn]]"
                show-spinner="{{requestInProcess}}"
                disable-confirm-btn="{{requestInProcess}}"
                on-confirm-btn-clicked="_saveEditedArea">
                <div class="row-h repeatable-item-container" without-line>
                    <div class="repeatable-item-content">
                        <div class="row-h group">
                            <div class="input-container input-container-l">
                                <!-- Risk Assessment -->
                                <etools-searchable-multiselection-menu
                                        id="riskRatingInput"
                                        class$="disabled-as-readonly {{_setRequired('key_internal_weakness.blueprints.risks.value', basePermissionPath)}} validate-input"
                                        value="{{editedBlueprint.risks.0.value}}"
                                        label="Risk rating"
                                        placeholder="Select Risk rating"
                                        options="[[riskOptions]]"
                                        custom-object-options
                                        option-label="display_name"
                                        option-value="display_name"
                                        required="{{_setRequired('key_internal_weakness.blueprints.risks.value', basePermissionPath)}}"
                                        disabled="{{requestInProcess}}"
                                        readonly$="{{requestInProcess}}"
                                        invalid="{{errors.blueprints.0.risks.value}}"
                                        error-message="{{errors.blueprints.0.risks.value}}"
                                        on-focus="_resetFieldError"
                                        hide-search
                                        no-title-attr="">
                                </etools-searchable-multiselection-menu>
                            </div>
                        </div>

                        <div class="row-h group">
                            <div class="input-container input-container-l">
                                <paper-textarea
                                        class$="disabled-as-readonly {{_setRequired('key_internal_weakness.blueprints.risks.extra', basePermissionPath)}} validate-input"
                                        value="{{editedBlueprint.risks.0.extra.key_control_observation}}"
                                        label="Key control observation"
                                        placeholder="Enter Observation"
                                        required="{{_setRequired('key_internal_weakness.blueprints.risks.extra', basePermissionPath)}}"
                                        disabled="{{requestInProcess}}"
                                        readonly="{{requestInProcess}}"
                                        max-rows="4"
                                        invalid="{{errors.blueprints.0.risks.extra}}"
                                        error-message="{{errors.blueprints.0.risks.extra}}"
                                        on-focus="_resetFieldError">
                                </paper-textarea>
                            </div>
                        </div>

                        <div class="row-h group">
                            <div class="input-container input-container-l">
                                <paper-textarea
                                        class$="disabled-as-readonly {{_setRequired('key_internal_weakness.blueprints.risks.extra', basePermissionPath)}} validate-input"
                                        value="{{editedBlueprint.risks.0.extra.recommendation}}"
                                        label="Recommendation"
                                        placeholder="Enter Recommendation"
                                        required="{{_setRequired('key_internal_weakness.blueprints.risks.extra', basePermissionPath)}}"
                                        disabled="{{requestInProcess}}"
                                        readonly="{{requestInProcess}}"
                                        max-rows="4"
                                        invalid="{{errors.blueprints.0.risks.extra}}"
                                        error-message="{{errors.blueprints.0.risks.extra}}"
                                        on-focus="_resetFieldError">
                                </paper-textarea>
                            </div>
                        </div>

                        <div class="row-h group">
                            <div class="input-container input-container-l">
                                <paper-textarea
                                        class$="disabled-as-readonly {{_setRequired('key_internal_weakness.blueprints.risks.extra', basePermissionPath)}} validate-input"
                                        value="{{editedBlueprint.risks.0.extra.ip_response}}"
                                        label="IP Response"
                                        placeholder="Enter Response"
                                        required="{{_setRequired('key_internal_weakness.blueprints.risks.extra', basePermissionPath)}}"
                                        disabled="{{requestInProcess}}"
                                        readonly="{{requestInProcess}}"
                                        max-rows="4"
                                        invalid="{{errors.blueprints.0.risks.extra}}"
                                        error-message="{{errors.blueprints.0.risks.extra}}"
                                        on-focus="_resetFieldError">
                                </paper-textarea>
                            </div>
                        </div>
                    </div>
                </div>
        </etools-dialog>
    </template>

    <!-- inject scripts './key-internal-controls-weaknesses.js'-->
</dom-module>
